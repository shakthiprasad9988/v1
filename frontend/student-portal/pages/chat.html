<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Portal - File Submission Portal</title>
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="../styles/chat.css">
    <link rel="stylesheet" href="../styles/global-search.css">
    <link rel="stylesheet" href="../styles/notifications.css">
    <link rel="stylesheet" href="../styles/transitions.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class='bx bx-file'></i>
                <span>FilePortal</span>
            </div>
        </div>

        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item">
                <i class='bx bx-home'></i>
                <span>Dashboard</span>
            </a>
            <a href="upload.html" class="nav-item">
                <i class='bx bx-upload'></i>
                <span>Upload Files</span>
            </a>
            <a href="submissions.html" class="nav-item">
                <i class='bx bx-folder'></i>
                <span>My Submissions</span>
            </a>
            <a href="feedback.html" class="nav-item">
                <i class='bx bx-message-square-detail'></i>
                <span>Feedback & Grades</span>
            </a>
            <a href="collaboration.html" class="nav-item">
                <i class='bx bx-group'></i>
                <span>Collaboration</span>
            </a>
            <a href="calendar.html" class="nav-item">
                <i class='bx bx-calendar'></i>
                <span>Calendar</span>
            </a>
            <a href="analytics.html" class="nav-item">
                <i class='bx bx-bar-chart'></i>
                <span>Analytics</span>
            </a>
            <a href="chat.html" class="nav-item active">
                <i class='bx bx-message-dots'></i>
                <span>Messages</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <a href="settings.html" class="nav-item">
                <i class='bx bx-cog'></i>
                <span>Settings</span>
            </a>
            <a href="../../shared/pages/login.html" class="nav-item">
                <i class='bx bx-log-out'></i>
                <span>Logout</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar -->
        <header class="topbar">
            <div class="topbar-left">
                <button class="menu-toggle" id="menuToggle">
                    <i class='bx bx-menu'></i>
                </button>
                <h1>Messages</h1>
            </div>
            
            <!-- Global Search -->
            <div class="global-search-container">
                <div class="global-search-wrapper">
                    <i class='bx bx-search search-icon'></i>
                    <input type="text" id="globalSearchInput" class="global-search-input" placeholder="Search submissions, feedback, groups..." autocomplete="off">
                    <span class="search-shortcut">Ctrl+K</span>
                </div>
                <div id="globalSearchResults" class="global-search-results"></div>
            </div>
            
            <div class="topbar-right">
                <button class="btn-new-chat" id="newChatBtn">
                    <i class='bx bx-plus'></i>
                    <span>New Chat</span>
                </button>
                <button class="notification-btn">
                    <i class='bx bx-bell'></i>
                    <span class="badge">3</span>
                </button>
                <div class="profile-menu">
                    <img src="https://ui-avatars.com/api/?name=Student+User&background=667eea&color=fff" alt="Profile">
                    <span>Student User</span>
                    <i class='bx bx-chevron-down'></i>
                </div>
            </div>
        </header>

        <!-- Chat Container -->
        <div class="chat-container">
            <!-- Chat Sidebar -->
            <aside class="chat-sidebar">
                <div class="chat-sidebar-header">
                    <div class="chat-search">
                        <i class='bx bx-search'></i>
                        <input type="text" id="chatSearch" placeholder="Search chats...">
                    </div>
                    <div class="chat-tabs">
                        <button class="chat-tab active" data-tab="direct">Direct</button>
                        <button class="chat-tab" data-tab="group">Groups</button>
                    </div>
                </div>
                <div id="chatList" class="chat-list">
                    <!-- Chat items will be rendered here -->
                </div>
            </aside>

            <!-- Chat Main Area -->
            <div class="chat-main">
                <!-- Empty State -->
                <div id="emptyChat" class="empty-chat">
                    <i class='bx bx-message-square-dots'></i>
                    <h3>Select a chat to start messaging</h3>
                    <p>Choose from your existing conversations or start a new one</p>
                </div>

                <!-- Active Chat -->
                <div id="activeChat" style="display: none; flex-direction: column; height: 100%;">
                    <div id="chatHeader" class="chat-header">
                        <!-- Chat header will be rendered here -->
                    </div>

                    <div id="messagesArea" class="messages-area">
                        <!-- Messages will be rendered here -->
                    </div>

                    <div class="message-input-area">
                        <div class="message-input-container">
                            <div class="input-actions">
                                <button class="input-btn" title="Attach file">
                                    <i class='bx bx-paperclip'></i>
                                </button>
                                <button class="input-btn" title="Emoji">
                                    <i class='bx bx-smile'></i>
                                </button>
                            </div>
                            <div class="message-input-wrapper">
                                <textarea id="messageInput" class="message-input" placeholder="Type a message..." rows="1"></textarea>
                            </div>
                            <button id="sendBtn" class="send-btn">
                                <i class='bx bx-send'></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- New Chat Modal -->
    <div id="newChatModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>New Chat</h2>
                <button class="close-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <button class="btn-modal btn-primary" id="createGroupBtn">
                    <i class='bx bx-group'></i> Create Group
                </button>
                <button class="btn-modal btn-secondary" id="joinGroupBtn">
                    <i class='bx bx-log-in'></i> Join Group with Code
                </button>
            </div>
        </div>
    </div>

    <!-- Create Group Modal -->
    <div id="createGroupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Group</h2>
                <button class="close-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Group Name</label>
                    <input type="text" id="groupName" placeholder="Enter group name">
                </div>
                <div class="form-group">
                    <label>Invite Code</label>
                    <div class="invite-code-display">
                        <input type="text" id="inviteCodeInput" readonly placeholder="Click generate">
                        <button class="copy-btn" onclick="copyInviteCode()">Copy</button>
                    </div>
                    <button class="btn-modal btn-secondary" id="generateCodeBtn" style="margin-top: 10px;">
                        <i class='bx bx-refresh'></i> Generate Code
                    </button>
                </div>
                <div class="modal-actions">
                    <button class="btn-modal btn-secondary close-modal">Cancel</button>
                    <button class="btn-modal btn-primary" id="createGroupSubmit">Create Group</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Join Group Modal -->
    <div id="joinGroupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Join Group</h2>
                <button class="close-modal"><i class='bx bx-x'></i></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Enter Invite Code</label>
                    <input type="text" id="joinCode" placeholder="Enter 8-character code" maxlength="8" style="text-transform: uppercase;">
                </div>
                <div class="modal-actions">
                    <button class="btn-modal btn-secondary close-modal">Cancel</button>
                    <button class="btn-modal btn-primary" id="joinGroupSubmit">Join Group</button>
                </div>
            </div>
        </div>
    </div>

    <script src="../../shared/utils/page-transition.js"></script>
    <script src="../utils/notifications.js"></script>
    <script src="../utils/dashboard.js"></script>
    <script src="../utils/chat.js"></script>
    <script src="../utils/global-search.js"></script>
    <script src="../utils/search-filters.js"></script>
    <script src="../utils/lazy-loader.js" defer></script>
    <script src="../utils/performance-monitor.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator && window.location.protocol !== 'file:') {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => console.log('✅ Service Worker registered'))
                    .catch(err => console.error('❌ SW registration failed:', err));
            });
        }
    </script>
</body>
</html>
