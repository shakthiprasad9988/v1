<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collaboration - File Submission Portal</title>
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="../styles/collaboration.css">
    <link rel="stylesheet" href="../styles/global-search.css">
    <link rel="stylesheet" href="../styles/notifications.css">
    <link rel="stylesheet" href="../styles/transitions.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class='bx bx-file'></i>
                <span>FilePortal</span>
            </div>
        </div>

        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item">
                <i class='bx bx-home'></i>
                <span>Dashboard</span>
            </a>
            <a href="upload.html" class="nav-item">
                <i class='bx bx-upload'></i>
                <span>Upload Files</span>
            </a>
            <a href="submissions.html" class="nav-item">
                <i class='bx bx-folder'></i>
                <span>My Submissions</span>
            </a>
            <a href="feedback.html" class="nav-item">
                <i class='bx bx-message-square-detail'></i>
                <span>Feedback & Grades</span>
            </a>
            <a href="collaboration.html" class="nav-item active">
                <i class='bx bx-group'></i>
                <span>Collaboration</span>
            </a>
            <a href="calendar.html" class="nav-item">
                <i class='bx bx-calendar'></i>
                <span>Calendar</span>
            </a>
            <a href="analytics.html" class="nav-item">
                <i class='bx bx-bar-chart'></i>
                <span>Analytics</span>
            </a>
            <a href="chat.html" class="nav-item">
                <i class='bx bx-message-dots'></i>
                <span>Messages</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <a href="settings.html" class="nav-item">
                <i class='bx bx-cog'></i>
                <span>Settings</span>
            </a>
            <a href="../../shared/pages/login.html" class="nav-item">
                <i class='bx bx-log-out'></i>
                <span>Logout</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar -->
        <header class="topbar">
            <div class="topbar-left">
                <button class="menu-toggle" id="menuToggle">
                    <i class='bx bx-menu'></i>
                </button>
                <h1>Collaboration</h1>
            </div>
            
            <!-- Global Search -->
            <div class="global-search-container">
                <div class="global-search-wrapper">
                    <i class='bx bx-search search-icon'></i>
                    <input type="text" id="globalSearchInput" class="global-search-input" placeholder="Search submissions, feedback, groups..." autocomplete="off">
                    <span class="search-shortcut">Ctrl+K</span>
                </div>
                <div id="globalSearchResults" class="global-search-results">
                    <!-- Search results will appear here -->
                </div>
            </div>
            
            <div class="topbar-right">
                <button class="icon-btn" onclick="openNotifications()" title="Notifications">
                    <i class='bx bx-bell'></i>
                    <span class="badge">5</span>
                </button>
                <div class="profile-menu">
                    <img src="https://ui-avatars.com/api/?name=Student+User&background=667eea&color=fff" alt="Profile">
                    <span>Student User</span>
                    <i class='bx bx-chevron-down'></i>
                </div>
            </div>
        </header>

        <!-- Collaboration Container -->
        <div class="collaboration-container">
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="groups">
                    <i class='bx bx-group'></i>
                    <span>Study Groups</span>
                </button>
                <button class="tab-btn" data-tab="group-assignments">
                    <i class='bx bx-folder-open'></i>
                    <span>Group Assignments</span>
                </button>
                <button class="tab-btn" data-tab="peer-review">
                    <i class='bx bx-edit'></i>
                    <span>Peer Review</span>
                </button>
            </div>

            <!-- Study Groups Tab -->
            <div id="groups-tab" class="tab-content active">
                <div class="section-header">
                    <h2>My Study Groups</h2>
                    <button class="btn btn-primary" onclick="openCreateGroupModal()">
                        <i class='bx bx-plus'></i> Create Group
                    </button>
                </div>

                <div id="studyGroupsList" class="groups-grid">
                    <!-- Groups will be loaded here -->
                </div>
            </div>

            <!-- Group Assignments Tab -->
            <div id="group-assignments-tab" class="tab-content">
                <div class="section-header">
                    <h2>Group Assignments</h2>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="active">Active</button>
                        <button class="filter-btn" data-filter="completed">Completed</button>
                    </div>
                </div>

                <div id="groupAssignmentsList" class="assignments-list">
                    <!-- Assignments will be loaded here -->
                </div>
            </div>

            <!-- Peer Review Tab -->
            <div id="peer-review-tab" class="tab-content">
                <div class="section-header">
                    <h2>Peer Review</h2>
                    <div class="review-stats">
                        <div class="stat-pill">
                            <i class='bx bx-time'></i>
                            <span>3 Pending</span>
                        </div>
                        <div class="stat-pill">
                            <i class='bx bx-check'></i>
                            <span>12 Completed</span>
                        </div>
                    </div>
                </div>

                <div id="peerReviewList" class="review-list">
                    <!-- Reviews will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Create Group Modal -->
    <div id="createGroupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class='bx bx-group'></i> Create Study Group</h2>
                <button class="close-modal" onclick="closeCreateGroupModal()">
                    <i class='bx bx-x'></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Group Name</label>
                    <input type="text" id="groupName" class="form-control" placeholder="e.g., Data Structures Study Group">
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea id="groupDescription" class="form-control" rows="3" placeholder="Brief description of the group purpose..."></textarea>
                </div>

                <div class="form-group">
                    <label>Course</label>
                    <select id="groupCourse" class="form-control">
                        <option value="">Select a course...</option>
                        <option value="data-structures">Data Structures</option>
                        <option value="web-dev">Web Development</option>
                        <option value="database">Database Systems</option>
                        <option value="ml">Machine Learning</option>
                        <option value="algorithms">Algorithm Design</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Add Members (use @mentions)</label>
                    <div class="mention-input-wrapper">
                        <input type="text" id="groupMembers" class="form-control mention-input" placeholder="Type @ to mention users...">
                        <div id="mentionSuggestions" class="mention-suggestions"></div>
                    </div>
                    <div id="selectedMembers" class="selected-members"></div>
                </div>

                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="closeCreateGroupModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="createGroup()">
                        <i class='bx bx-check'></i> Create Group
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Group Details Modal -->
    <div id="groupDetailsModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="groupDetailsTitle"></h2>
                <button class="close-modal" onclick="closeGroupDetailsModal()">
                    <i class='bx bx-x'></i>
                </button>
            </div>
            <div class="modal-body" id="groupDetailsBody">
                <!-- Group details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Peer Review Modal -->
    <div id="peerReviewModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2><i class='bx bx-edit'></i> Peer Review</h2>
                <button class="close-modal" onclick="closePeerReviewModal()">
                    <i class='bx bx-x'></i>
                </button>
            </div>
            <div class="modal-body" id="peerReviewBody">
                <!-- Review content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Notifications Panel -->
    <div id="notificationsPanel" class="notifications-panel">
        <div class="panel-header">
            <h3><i class='bx bx-bell'></i> Notifications</h3>
            <button class="close-panel" onclick="closeNotifications()">
                <i class='bx bx-x'></i>
            </button>
        </div>
        <div class="panel-body" id="notificationsList">
            <!-- Notifications will be loaded here -->
        </div>
    </div>

    <script src="../../shared/utils/page-transition.js"></script>
    <script src="../utils/notifications.js"></script>
    <script src="../utils/dashboard.js"></script>
    <script src="../utils/collaboration.js"></script>
    <script src="../utils/global-search.js"></script>
    <script src="../utils/search-filters.js"></script>
    <script src="../utils/lazy-loader.js" defer></script>
    <script src="../utils/performance-monitor.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator && window.location.protocol !== 'file:') {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => console.log('✅ Service Worker registered'))
                    .catch(err => console.error('❌ SW registration failed:', err));
            });
        }
    </script>
</body>
</html>
